"use strict";angular.module("angular-rickshaw",[]).directive("rickshaw",["$compile","$window",function(e,r){return{restrict:"EA",scope:{options:"=rickshawOptions",series:"=rickshawSeries",features:"=rickshawFeatures"},link:function(a,i,t){function s(){w.setSize(),w.render()}function n(e){var r=e.data,a=e.series;return e.series?void a.forEach(function(e){var a=e.key||e.name;if(!a)throw"series needs a key or a name";r.forEach(function(r){var i=r.key||r.name;if(!i)throw"data needs a key or a name";if(a==i){var t=["color","name","data"];t.forEach(function(a){r[a]&&(e[a]=r[a])})}})}):r}function o(){w&&k&&(n({data:a.series,series:k.series}),s())}function c(){if(w){if(a.options){for(var r in a.options)k[r]=a.options[r],console.log(r+"="+a.options[r]);k.element=u[0]}w.configure(k)}else f=angular.element(i),f.append(u),f.empty(),u=e("<div></div>")(a),f.append(u),k=angular.copy(a.options),k.element=u[0],k.series=a.series,w=new Rickshaw.Graph(k);if(a.features){if(a.features.hover){var t={graph:w};t.xFormatter=a.features.hover.xFormatter,t.yFormatter=a.features.hover.yFormatter,t.formatter=a.features.hover.formatter;new Rickshaw.Graph.HoverDetail(t)}if(a.features.palette)for(var n=new Rickshaw.Color.Palette({scheme:a.features.palette}),o=0;o<k.series.length;o++)k.series[o].color=n.color()}if(s(),a.features){if(a.features.xAxis&&!m){var c={graph:w};if(a.features.xAxis.timeUnit){var g=new Rickshaw.Fixtures.Time;c.timeUnit=g.unit(a.features.xAxis.timeUnit)}a.features.xAxis.tickFormat&&(c.tickFormat=a.features.xAxis.tickFormat),a.features.xAxis.ticksTreatment&&(c.ticksTreatment=a.features.xAxis.ticksTreatment),a.features.xAxis.time?(a.features.xAxis.time.local&&(c.timeFixture=new Rickshaw.Fixtures.Time.Local),m=new Rickshaw.Graph.Axis.Time(c)):m=new Rickshaw.Graph.Axis.X(c),m.render()}if(a.features.yAxis){var d={graph:w};if(a.features.yAxis.tickFormat){var v=a.features.yAxis.tickFormat;"string"==typeof v?d.tickFormat=Rickshaw.Fixtures.Number[v]:d.tickFormat=v}p||(p=new Rickshaw.Graph.Axis.Y(d),p.render())}if(a.features.legend){if(!h){h=e("<div></div>")(a),f.append(h);var x=new Rickshaw.Graph.Legend({graph:w,element:h[0]});if(a.features.legend.toggle){new Rickshaw.Graph.Behavior.Series.Toggle({graph:w,legend:x})}if(a.features.legend.highlight){new Rickshaw.Graph.Behavior.Series.Highlight({graph:w,legend:x})}}}else h&&(h.remove(),h=null);a.features.preview?l||(l=e("<div></div>")(a),f.append(l),new Rickshaw.Graph.RangeSlider.Preview({graph:w,element:l[0]})):l&&(l.remove(),l=null)}}var f,u,h,l,m,p,w,k,g=a.$watch("options",function(e,r){angular.equals(e,r)||c()},!0),d=a.$watchCollection("series",function(e,r){angular.equals(e,r)||o()},!0),v=a.$watch("features",function(e,r){angular.equals(e,r)||c()},!0);a.$on("$destroy",function(){g(),d(),v()}),angular.element(r).on("resize",function(){a.$broadcast("rickshaw::resize")}),a.$on("rickshaw::resize",function(){s()}),c()},controller:["$scope","$element","$attrs",function(e,r,a){}]}}]);