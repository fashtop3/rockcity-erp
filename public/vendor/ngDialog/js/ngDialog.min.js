!function(e,o){"undefined"!=typeof module&&module.exports?(o("undefined"==typeof angular?require("angular"):angular),module.exports="ngDialog"):"function"==typeof define&&define.amd?define(["angular"],o):o(e.angular)}(this,function(e){"use strict";var o=e.module("ngDialog",[]),a=e.element,n=e.isDefined,t=(document.body||document.documentElement).style,l=n(t.animation)||n(t.WebkitAnimation)||n(t.MozAnimation)||n(t.MsAnimation)||n(t.OAnimation),i="animationend webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend",r="a[href], area[href], input:not([disabled]), select:not([disabled]), textarea:not([disabled]), button:not([disabled]), iframe, object, embed, *[tabindex], *[contenteditable]",s="ngdialog-disabled-animation",c={html:!1,body:!1},d={},g=[],u=!1,f=!1;return o.provider("ngDialog",function(){var o=this.defaults={className:"ngdialog-theme-default",disableAnimation:!1,plain:!1,showClose:!0,closeByDocument:!0,closeByEscape:!0,closeByNavigation:!1,appendTo:!1,preCloseCallback:!1,overlay:!0,cache:!0,trapFocus:!0,preserveFocus:!0,ariaAuto:!0,ariaRole:null,ariaLabelledById:null,ariaLabelledBySelector:null,ariaDescribedById:null,ariaDescribedBySelector:null};this.setForceHtmlReload=function(e){c.html=e||!1},this.setForceBodyReload=function(e){c.body=e||!1},this.setDefaults=function(a){e.extend(o,a)},this.setOpenOnePerName=function(e){f=e||!1};var n,t=0,p=0,m={};this.$get=["$document","$templateCache","$compile","$q","$http","$rootScope","$timeout","$window","$controller","$injector",function(v,y,b,D,h,C,$,A,E,B){var S=[],k={onDocumentKeydown:function(e){27===e.keyCode&&w.close("$escape")},activate:function(e){var o=e.data("$ngDialogOptions");o.trapFocus&&(e.on("keydown",k.onTrapFocusKeydown),S.body.on("keydown",k.onTrapFocusKeydown))},deactivate:function(e){e.off("keydown",k.onTrapFocusKeydown),S.body.off("keydown",k.onTrapFocusKeydown)},deactivateAll:function(o){e.forEach(o,function(o){var a=e.element(o);k.deactivate(a)})},setBodyPadding:function(e){var o=parseInt(S.body.css("padding-right")||0,10);S.body.css("padding-right",o+e+"px"),S.body.data("ng-dialog-original-padding",o),C.$broadcast("ngDialog.setPadding",e)},resetBodyPadding:function(){var e=S.body.data("ng-dialog-original-padding");e?S.body.css("padding-right",e+"px"):S.body.css("padding-right",""),C.$broadcast("ngDialog.setPadding",0)},performCloseDialog:function(e,o){var a=e.data("$ngDialogOptions"),t=e.attr("id"),r=d[t];if(r){if("undefined"!=typeof A.Hammer){var s=r.hammerTime;s.off("tap",n),s.destroy&&s.destroy(),delete r.hammerTime}else e.unbind("click");1===p&&S.body.unbind("keydown",k.onDocumentKeydown),e.hasClass("ngdialog-closing")||(p-=1);var c=e.data("$ngDialogPreviousFocus");c&&c.focus&&c.focus(),C.$broadcast("ngDialog.closing",e,o),p=0>p?0:p,l&&!a.disableAnimation?(r.$destroy(),e.unbind(i).bind(i,function(){k.closeDialogElement(e,o)}).addClass("ngdialog-closing")):(r.$destroy(),k.closeDialogElement(e,o)),m[t]&&(m[t].resolve({id:t,value:o,$dialog:e,remainingDialogs:p}),delete m[t]),d[t]&&delete d[t],g.splice(g.indexOf(t),1),g.length||(S.body.unbind("keydown",k.onDocumentKeydown),u=!1)}},closeDialogElement:function(e,o){e.remove(),0===p&&(S.html.removeClass("ngdialog-open"),S.body.removeClass("ngdialog-open"),k.resetBodyPadding()),C.$broadcast("ngDialog.closed",e,o)},closeDialog:function(o,a){var n=o.data("$ngDialogPreCloseCallback");if(n&&e.isFunction(n)){var t=n.call(o,a);e.isObject(t)?t.closePromise?t.closePromise.then(function(){k.performCloseDialog(o,a)}):t.then(function(){k.performCloseDialog(o,a)},function(){}):t!==!1&&k.performCloseDialog(o,a)}else k.performCloseDialog(o,a)},onTrapFocusKeydown:function(o){var a,n=e.element(o.currentTarget);if(n.hasClass("ngdialog"))a=n;else if(a=k.getActiveDialog(),null===a)return;var t=9===o.keyCode,l=o.shiftKey===!0;t&&k.handleTab(a,o,l)},handleTab:function(e,o,a){var n=k.getFocusableElements(e);if(0===n.length)return void(document.activeElement&&document.activeElement.blur());var t=document.activeElement,l=Array.prototype.indexOf.call(n,t),i=-1===l,r=0===l,s=l===n.length-1,c=!1;a?(i||r)&&(n[n.length-1].focus(),c=!0):(i||s)&&(n[0].focus(),c=!0),c&&(o.preventDefault(),o.stopPropagation())},autoFocus:function(e){var o=e[0],n=o.querySelector("*[autofocus]");if(null===n||(n.focus(),document.activeElement!==n)){var t=k.getFocusableElements(e);if(t.length>0)return void t[0].focus();var l=k.filterVisibleElements(o.querySelectorAll("h1,h2,h3,h4,h5,h6,p,span"));if(l.length>0){var i=l[0];a(i).attr("tabindex","-1").css("outline","0"),i.focus()}}},getFocusableElements:function(e){var o=e[0],a=o.querySelectorAll(r),n=k.filterTabbableElements(a);return k.filterVisibleElements(n)},filterTabbableElements:function(e){for(var o=[],n=0;n<e.length;n++){var t=e[n];"-1"!==a(t).attr("tabindex")&&o.push(t)}return o},filterVisibleElements:function(e){for(var o=[],a=0;a<e.length;a++){var n=e[a];(n.offsetWidth>0||n.offsetHeight>0)&&o.push(n)}return o},getActiveDialog:function(){var e=document.querySelectorAll(".ngdialog");return 0===e.length?null:a(e[e.length-1])},applyAriaAttributes:function(e,o){if(o.ariaAuto){if(!o.ariaRole){var a=k.getFocusableElements(e).length>0?"dialog":"alertdialog";o.ariaRole=a}o.ariaLabelledBySelector||(o.ariaLabelledBySelector="h1,h2,h3,h4,h5,h6"),o.ariaDescribedBySelector||(o.ariaDescribedBySelector="article,section,p")}o.ariaRole&&e.attr("role",o.ariaRole),k.applyAriaAttribute(e,"aria-labelledby",o.ariaLabelledById,o.ariaLabelledBySelector),k.applyAriaAttribute(e,"aria-describedby",o.ariaDescribedById,o.ariaDescribedBySelector)},applyAriaAttribute:function(e,o,n,t){if(n&&e.attr(o,n),t){var l=e.attr("id"),i=e[0].querySelector(t);if(!i)return;var r=l+"-"+o;return a(i).attr("id",r),e.attr(o,r),r}},detectUIRouter:function(){try{return e.module("ui.router"),!0}catch(o){return!1}},getRouterLocationEventName:function(){return k.detectUIRouter()?"$stateChangeSuccess":"$locationChangeSuccess"}},w={__PRIVATE__:k,open:function(l){function i(e,o){return C.$broadcast("ngDialog.templateLoading",e),h.get(e,o||{}).then(function(o){return C.$broadcast("ngDialog.templateLoaded",e),o.data||""})}function r(o){return o?e.isString(o)&&v.plain?o:"boolean"!=typeof v.cache||v.cache?i(o,{cache:y}):i(o,{cache:!1}):"Empty template"}var c=null;if(l=l||{},!(f&&l.name&&(c=l.name+" dialog",this.isOpen(c)))){var v=e.copy(o),F=++t;c=c||"ngdialog"+F,g.push(c),e.extend(v,l);var T;m[c]=T=D.defer();var P;d[c]=P=e.isObject(v.scope)?v.scope.$new():C.$new();var O,I,x=e.extend({},v.resolve);return e.forEach(x,function(o,a){x[a]=e.isString(o)?B.get(o):B.invoke(o,null,null,a)}),D.all({template:r(v.template||v.templateUrl),locals:D.all(x)}).then(function(o){var t=o.template,l=o.locals;v.showClose&&(t+='<div class="ngdialog-close"></div>');var i=v.overlay?"":" ngdialog-no-overlay";if(O=a('<div id="'+c+'" class="ngdialog'+i+'"></div>'),O.html(v.overlay?'<div class="ngdialog-overlay"></div><div class="ngdialog-content" role="document">'+t+"</div>":'<div class="ngdialog-content" role="document">'+t+"</div>"),O.data("$ngDialogOptions",v),P.ngDialogId=c,v.data&&e.isString(v.data)){var r=v.data.replace(/^\s*/,"")[0];P.ngDialogData="{"===r||"["===r?e.fromJson(v.data):new String(v.data),P.ngDialogData.ngDialogId=c}else v.data&&e.isObject(v.data)&&(P.ngDialogData=v.data,P.ngDialogData.ngDialogId=c);if(v.className&&O.addClass(v.className),v.disableAnimation&&O.addClass(s),I=v.appendTo&&e.isString(v.appendTo)?e.element(document.querySelector(v.appendTo)):S.body,k.applyAriaAttributes(O,v),v.preCloseCallback){var d;e.isFunction(v.preCloseCallback)?d=v.preCloseCallback:e.isString(v.preCloseCallback)&&P&&(e.isFunction(P[v.preCloseCallback])?d=P[v.preCloseCallback]:P.$parent&&e.isFunction(P.$parent[v.preCloseCallback])?d=P.$parent[v.preCloseCallback]:C&&e.isFunction(C[v.preCloseCallback])&&(d=C[v.preCloseCallback])),d&&O.data("$ngDialogPreCloseCallback",d)}if(P.closeThisDialog=function(e){k.closeDialog(O,e)},v.controller&&(e.isString(v.controller)||e.isArray(v.controller)||e.isFunction(v.controller))){var g;v.controllerAs&&e.isString(v.controllerAs)&&(g=v.controllerAs);var f=E(v.controller,e.extend(l,{$scope:P,$element:O}),!0,g);v.bindToController&&e.extend(f.instance,{ngDialogId:P.ngDialogId,ngDialogData:P.ngDialogData,closeThisDialog:P.closeThisDialog}),O.data("$ngDialogControllerController",f())}if($(function(){var e=document.querySelectorAll(".ngdialog");k.deactivateAll(e),b(O)(P);var o=A.innerWidth-S.body.prop("clientWidth");S.html.addClass("ngdialog-open"),S.body.addClass("ngdialog-open");var a=o-(A.innerWidth-S.body.prop("clientWidth"));a>0&&k.setBodyPadding(a),I.append(O),k.activate(O),v.trapFocus&&k.autoFocus(O),v.name?C.$broadcast("ngDialog.opened",{dialog:O,name:v.name}):C.$broadcast("ngDialog.opened",O)}),u||(S.body.bind("keydown",k.onDocumentKeydown),u=!0),v.closeByNavigation){var m=k.getRouterLocationEventName();C.$on(m,function(){k.closeDialog(O)})}if(v.preserveFocus&&O.data("$ngDialogPreviousFocus",document.activeElement),n=function(e){var o=!!v.closeByDocument&&a(e.target).hasClass("ngdialog-overlay"),n=a(e.target).hasClass("ngdialog-close");(o||n)&&w.close(O.attr("id"),n?"$closeButton":"$document")},"undefined"!=typeof A.Hammer){var y=P.hammerTime=A.Hammer(O[0]);y.on("tap",n)}else O.bind("click",n);return p+=1,w}),{id:c,closePromise:T.promise,close:function(e){k.closeDialog(O,e)}}}},openConfirm:function(n){var t=D.defer(),l=e.copy(o);n=n||{},e.extend(l,n),l.scope=e.isObject(l.scope)?l.scope.$new():C.$new(),l.scope.confirm=function(e){t.resolve(e);var o=a(document.getElementById(i.id));k.performCloseDialog(o,e)};var i=w.open(l);return i?(i.closePromise.then(function(e){return e?t.reject(e.value):t.reject()}),t.promise):void 0},isOpen:function(e){var o=a(document.getElementById(e));return o.length>0},close:function(e,o){var n=a(document.getElementById(e));if(n.length)k.closeDialog(n,o);else if("$escape"===e){var t=g[g.length-1];n=a(document.getElementById(t)),n.data("$ngDialogOptions").closeByEscape&&k.closeDialog(n,"$escape")}else w.closeAll(o);return w},closeAll:function(e){for(var o=document.querySelectorAll(".ngdialog"),n=o.length-1;n>=0;n--){var t=o[n];k.closeDialog(a(t),e)}},getOpenDialogs:function(){return g},getDefaults:function(){return o}};return e.forEach(["html","body"],function(e){if(S[e]=v.find(e),c[e]){var o=k.getRouterLocationEventName();C.$on(o,function(){S[e]=v.find(e)})}}),w}]}),o.directive("ngDialog",["ngDialog",function(o){return{restrict:"A",scope:{ngDialogScope:"="},link:function(a,n,t){n.on("click",function(n){n.preventDefault();var l=e.isDefined(a.ngDialogScope)?a.ngDialogScope:"noScope";e.isDefined(t.ngDialogClosePrevious)&&o.close(t.ngDialogClosePrevious);var i=o.getDefaults();o.open({template:t.ngDialog,className:t.ngDialogClass||i.className,controller:t.ngDialogController,controllerAs:t.ngDialogControllerAs,bindToController:t.ngDialogBindToController,scope:l,data:t.ngDialogData,showClose:"false"!==t.ngDialogShowClose&&("true"===t.ngDialogShowClose||i.showClose),closeByDocument:"false"!==t.ngDialogCloseByDocument&&("true"===t.ngDialogCloseByDocument||i.closeByDocument),closeByEscape:"false"!==t.ngDialogCloseByEscape&&("true"===t.ngDialogCloseByEscape||i.closeByEscape),overlay:"false"!==t.ngDialogOverlay&&("true"===t.ngDialogOverlay||i.overlay),preCloseCallback:t.ngDialogPreCloseCallback||i.preCloseCallback})})}}}]),o});